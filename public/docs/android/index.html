<!doctype html><html data-theme=light lang=en><head><title>Android api usage | Scatterbrain</title><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="Guide on how to develop android applications that leverage the Scatterbrain binder api" name=description><link href=/css/main.css?v0MmPc integrity=sha384-v0MmPc6jng5IB7QPiAV/T/ZVuPJ01qtoqkIR5yBHAZQnGY0qjjWsWMKkPMzG1h0b rel=stylesheet><link title="RSS Feed" href=/atom.xml rel=alternate type=application/rss+xml><script>// select default theme based on preferred color scheme (as set in the browser)
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            default_theme = 'night'
        } else {
            default_theme = 'light'
        }

        // try to get theme from local storage and set it (or the default theme) to the HTML element
        const theme = localStorage.getItem('theme') || default_theme;
        document.documentElement.setAttribute("data-theme", theme);

        // execute code after the DOM content was loaded
        document.addEventListener("DOMContentLoaded", function (event) {
            // select theme at the theme selector (if it is present in the HTML code)
            var btnEl = document.querySelector("[data-set-theme='" + theme.toString() + "']");
            if (btnEl) {
                btnEl.classList.add("btn-active")
                btnEl.classList.add("btn-primary")
            }
        })</script><body class=h-screen><div class="@container drawer min-h-full"><input class="drawer-toggle lg:hidden" id=main-drawer type=checkbox><div class="drawer-content flex min-h-full flex-col"><div class="fixed inset-x-0 top-0 z-10 text-primary-content bg-primary shadow-sm opacity-93"><div class="flex flex-col items-center justify-between"><div class=navbar><div class=navbar-start><label aria-label="open sidebar" class="btn btn-square btn-ghost swap swap-rotate hover:bg-primary-content hover:text-primary lg:hidden" for=main-drawer><svg class="inline-block h-4 w-4 mr-2 h-6 w-6 swap-off [:checked~*_&]:!-rotate-45 [:checked~*_&]:!opacity-0" viewbox="0 0 16 16" aria-label=List fill=currentColor role=img xmlns=http://www.w3.org/2000/svg><path d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" fill-rule=evenodd /></svg> <svg class="inline-block h-4 w-4 mr-2 h-5 w-5 swap-on [:checked~*_&]:!rotate-0 [:checked~*_&]:!opacity-100" viewbox="0 0 16 16" aria-label=X fill=currentColor role=img xmlns=http://www.w3.org/2000/svg><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg></label><a class="btn btn-ghost hover:bg-primary-content hover:text-primary text-xl no-underline" href=/>Scatterbrain</a><div class="navbar-center max-md:hidden lg:flex"><ul class="menu menu-horizontal px-1 gap-x-2"><li><a class="hover:bg-primary-content hover:text-primary no-underline px-3 rounded-md" href=/get_started> <span>Get Started</span> </a><li><a class="bg-secondary text-secondary-content no-underline px-3 rounded-md" href=/docs> <span>Docs</span> </a><li><a class="hover:bg-primary-content hover:text-primary no-underline px-3 rounded-md" href=/blog> <span>Blog</span> </a></ul></div></div><div class=navbar-end><div class=max-md:hidden><label class="input text-primary bg-primary-content focus:outline-teal-500" tabindex=0><svg class="inline-block h-4 w-4 mr-2 h-[1em] opacity-50" viewbox="0 0 16 16" aria-label=Search fill=currentColor role=img xmlns=http://www.w3.org/2000/svg><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/></svg> <input class="search-input grow" id=desktop-search placeholder=Search type=search> <kbd class="kbd kbd-sm bg-primary text-primary-content">âŒ˜</kbd> <kbd class="kbd kbd-sm bg-primary text-primary-content">K</kbd></label></div><label aria-label="open search" class="btn btn-square btn-ghost swap swap-rotate hover:bg-primary-content hover:text-primary md:hidden" for=search-bar id=search-button><svg class="inline-block h-4 w-4 mr-2 " viewbox="0 0 16 16" aria-label=Search fill=currentColor role=img xmlns=http://www.w3.org/2000/svg><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/></svg></label></div></div><div class="hidden md:hidden pl-2 pr-2 pb-2 w-full" id=search-bar><label class="input text-primary bg-primary-content w-full" tabindex=0><svg class="inline-block h-4 w-4 mr-2 h-[1em] opacity-50" viewbox="0 0 16 16" aria-label=Search fill=currentColor role=img xmlns=http://www.w3.org/2000/svg><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/></svg> <input class="search-input grow" id=mobile-search placeholder=Search type=search></label></div></div></div><div class="grid min-h-dvh grid-rows-[1fr_1px_auto_1px_auto] grid-cols-1"><div class="relative col-start-1 row-span-full row-start-1 hidden max-lg:hidden bg-base-200"><div class="absolute inset-0"><div class="sticky top-16 pt-4 bottom-0 left-0 h-full max-h-[calc(100dvh-(var(--spacing)*16))] w-full overflow-y-auto px-6"><div><nav class="flex flex-col gap-8"></nav></div></div></div></div><main class="relative row-start-1 grid grid-cols-subgrid m-4"><div class="isolate grid max-w-2xl grid-cols-1 gap-10 mt-14 md:pt-6 md:pb-24 xl:max-w-4xl mx-auto"><div class="search-results dropdown-content hidden bg-base-200 text-base-content rounded-box z-1 p-2 shadow-2xl list-none max-w-4xl flex-row lg:absolute lg:right-0 lg:mr-4 max-md:mt-10" tabindex=0><div class=search-results__items></div></div><div class=pb-8><div class="breadcrumbs text-sm"><ul><li><a href=/>Home</a><li><a class=breadcrumb-path href=https://scatterbrain.ballmerlabs.net/docs/></a><li><a class="breadcrumb-path active" href=https://scatterbrain.ballmerlabs.net/docs/android/>Android api usage</a></ul></div><h1>Android api usage</h1><div class="flex flex-wrap space-x-6 gap-y-2 pl-1 mb-4"></div><p>Building a Scatterbrain android app requires communicating with the Scatterbrain Router app via android IPC apis. The easiest and most recommended way to do this is by including the <a href=https://github.com/Scatterbrain-DTN/ScatterbrainSDK>ScatterbrainSDK</a> library to your android app. This library exposes a clean and simple kotlin coroutine based API that allows building responsive apps that follow best practices and do not make mistakes like blocking the UI thread.<h2 id=setting-up-the-api>Setting up the api</h2><p>To add Scatterbrain to an existing android project:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">git</span></span><span class="z-meta z-function-call z-arguments z-shell"> submodule add https://github.com/Scatterbrain-DTN/ScatterbrainSDK.git</span>
</span></code></pre><p>Then edit your projects <code>settings.gradle</code> to include<pre class="language-groovy z-code" data-lang=groovy><code class=language-groovy data-lang=groovy><span class="z-source z-groovy">include <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>:sdk<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>
</span><span class="z-source z-groovy"><span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">project</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>:sdk<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span><span class="z-punctuation z-accessor z-dot z-groovy">.</span>projectDir <span class="z-keyword z-operator z-assignment z-groovy">=</span> <span class="z-keyword z-other z-new z-groovy">new</span> <span class="z-storage z-type z-class z-groovy">File</span>(rootDir, <span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>ScatterbrainSDK/scatterbrainSDK/<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span>)
</span></code></pre><p>Then edit your module-level <code>build.gradle</code> to include<pre class="language-groovy z-code" data-lang=groovy><code class=language-groovy data-lang=groovy><span class="z-source z-groovy">implementation <span class="z-meta z-method-call z-groovy"><span class="z-meta z-method z-groovy">project</span><span class="z-punctuation z-definition z-method-parameters z-begin z-groovy">(</span><span class="z-string z-quoted z-single z-groovy"><span class="z-punctuation z-definition z-string z-begin z-groovy">'</span>:sdk<span class="z-punctuation z-definition z-string z-end z-groovy">'</span></span><span class="z-punctuation z-definition z-method-parameters z-end z-groovy">)</span></span>
</span></code></pre><p>Or edit <code>build.gradle.kts</code> if using gradle kotlin DSL<pre class="language-kotlin z-code" data-lang=kotlin><code class=language-kotlin data-lang=kotlin><span class="z-source z-Kotlin">implementation(project(<span class="z-string z-quoted z-single z-kotlin"><span class="z-punctuation z-definition z-string z-begin z-kotlin">'</span>:sdk<span class="z-punctuation z-definition z-string z-end z-kotlin">'</span></span>))
</span></code></pre><h2 id=using-the-api>Using the api</h2><p>Some simple examples of API usage:<h3 id=send-a-message>Send a message</h3><pre class="language-kt z-code" data-lang=kt><code class=language-kt data-lang=kt><span class="z-source z-Kotlin"><span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">api</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span> ScatterbrainApi(context)
</span><span class="z-source z-Kotlin"><span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">text</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span> <span class="z-string z-quoted z-double z-kotlin"><span class="z-punctuation z-definition z-string z-begin z-kotlin">"</span>hello world<span class="z-punctuation z-definition z-string z-end z-kotlin">"</span></span><span class="z-keyword z-operator z-dot z-kotlin">.</span>toByteArray(charset <span class="z-keyword z-operator z-assignment z-kotlin">=</span> Charsets<span class="z-keyword z-operator z-dot z-kotlin">.</span><span class="z-constant z-other z-kotlin">UTF_8</span>)
</span><span class="z-source z-Kotlin"><span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">m</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span> ScatterMessage<span class="z-keyword z-operator z-dot z-kotlin">.</span>Builder<span class="z-keyword z-operator z-dot z-kotlin">.</span>newInstance(context, text)
</span><span class="z-source z-Kotlin">    <span class="z-keyword z-operator z-dot z-kotlin">.</span>setApplication(<span class="z-string z-quoted z-double z-kotlin"><span class="z-punctuation z-definition z-string z-begin z-kotlin">"</span>myapp<span class="z-punctuation z-definition z-string z-end z-kotlin">"</span></span>)
</span><span class="z-source z-Kotlin">    <span class="z-keyword z-operator z-dot z-kotlin">.</span>build()
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">runBlocking { api<span class="z-keyword z-operator z-dot z-kotlin">.</span>binderWrapper<span class="z-keyword z-operator z-dot z-kotlin">.</span>sendMessage(m) }
</span></code></pre><h3 id=handle-broadcasts>Handle broadcasts</h3><p>First define a BroadcastReceiver class to handle broadcasts. There are 2 main types of broadcasts to consider. <code>BROADCAST_EVENT</code> is fired when a remote peer completes a handshake, potentially delivering messages and identities. <code>STATE_EVENT</code> is fired when the Scatterbrain Router app changes state, ie. when bluetooth or wifi are enabled/disabled or discovery is paused.<pre class="language-kt z-code" data-lang=kt><code class=language-kt data-lang=kt><span class="z-source z-Kotlin"><span class="z-comment z-line z-double-slash z-kotlin"><span class="z-punctuation z-definition z-comment z-kotlin">//</span> Define a broadcastReceiver to handle Scatterbrain broadcasts
</span></span><span class="z-source z-Kotlin"><span class="z-storage z-modifier z-kotlin">class</span> <span class="z-entity z-name z-type z-class z-kotlin">ScatterbrainBroadcastReceiver</span><span class="z-keyword z-operator z-declaration z-kotlin">:</span> <span class="z-entity z-other z-inherited-class z-kotlin">BroadcastReceiver</span>() {
</span><span class="z-source z-Kotlin">    <span class="z-storage z-modifier z-kotlin">override</span> <span class="z-keyword z-other z-kotlin">fun</span> <span class="z-entity z-name z-function z-kotlin">onReceive</span>(<span class="z-variable z-parameter z-function z-kotlin">context</span><span class="z-keyword z-operator z-declaration z-kotlin">:</span> Context?, <span class="z-variable z-parameter z-function z-kotlin">intent</span><span class="z-keyword z-operator z-declaration z-kotlin">:</span> Intent) {
</span><span class="z-source z-Kotlin">        <span class="z-keyword z-control z-kotlin">when</span>(intent<span class="z-keyword z-operator z-dot z-kotlin">.</span>action) {
</span><span class="z-source z-Kotlin">            <span class="z-constant z-other z-kotlin">BROADCAST_EVENT</span> <span class="z-keyword z-operator z-declaration z-kotlin">-></span> {
</span><span class="z-source z-Kotlin">                <span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">handshakeResult</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span>
</span><span class="z-source z-Kotlin">                    intent<span class="z-keyword z-operator z-dot z-kotlin">.</span>getParcelableExtra&lt;HandshakeResult>(
</span><span class="z-source z-Kotlin">                        <span class="z-constant z-other z-kotlin">EXTRA_TRANSACTION_RESULT</span>
</span><span class="z-source z-Kotlin">                    )
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">                <span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">luid</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span> intent<span class="z-keyword z-operator z-dot z-kotlin">.</span>getParcelableExtra&lt;ParcelUuid>(<span class="z-constant z-other z-kotlin">EXTRA_LUID</span>)
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">                <span class="z-comment z-line z-double-slash z-kotlin"><span class="z-punctuation z-definition z-comment z-kotlin">//</span> handle incoming messages using the ScatterbrainApi class
</span></span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">            }
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">            <span class="z-constant z-other z-kotlin">STATE_EVENT</span> <span class="z-keyword z-operator z-declaration z-kotlin">-></span> {
</span><span class="z-source z-Kotlin">                <span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">state</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span>
</span><span class="z-source z-Kotlin">                    intent<span class="z-keyword z-operator z-dot z-kotlin">.</span>getParcelableExtra&lt;RouterState>(<span class="z-constant z-other z-kotlin">EXTRA_ROUTER_STATE</span>)
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">                <span class="z-comment z-line z-double-slash z-kotlin"><span class="z-punctuation z-definition z-comment z-kotlin">//</span> Handle state changes, including enabled and disabled discovery
</span></span><span class="z-source z-Kotlin">            }
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">            <span class="z-constant z-other z-kotlin">PAIRING_EVENT</span> <span class="z-keyword z-operator z-declaration z-kotlin">-></span> {
</span><span class="z-source z-Kotlin">                <span class="z-comment z-line z-double-slash z-kotlin"><span class="z-punctuation z-definition z-comment z-kotlin">//</span>/ 3rd party apps should ignore desktop pairing broadcasts
</span></span><span class="z-source z-Kotlin">            }
</span><span class="z-source z-Kotlin">        }
</span><span class="z-source z-Kotlin">    }
</span><span class="z-source z-Kotlin">}
</span></code></pre><p>Register your broadcast receiver with an IntentFilter. Make sure to unregister it when you are done using it.<pre class="language-kt z-code" data-lang=kt><code class=language-kt data-lang=kt><span class="z-source z-Kotlin"><span class="z-keyword z-other z-kotlin">val</span> <span class="z-entity z-name z-variable z-kotlin">intentFilter</span> <span class="z-keyword z-operator z-assignment z-kotlin">=</span> IntentFilter()
</span><span class="z-source z-Kotlin">       <span class="z-keyword z-operator z-dot z-kotlin">.</span>apply {
</span><span class="z-source z-Kotlin">           addAction(<span class="z-constant z-other z-kotlin">BROADCAST_EVENT</span>)
</span><span class="z-source z-Kotlin">           addAction(<span class="z-constant z-other z-kotlin">STATE_EVENT</span>)
</span><span class="z-source z-Kotlin">       }
</span><span class="z-source z-Kotlin">
</span><span class="z-source z-Kotlin">context<span class="z-keyword z-operator z-dot z-kotlin">.</span>registerReceiver(ScatterbrainBroadcastReceiver(), intentFilter, Context<span class="z-keyword z-operator z-dot z-kotlin">.</span><span class="z-constant z-other z-kotlin">RECEIVER_EXPORTED</span>)
</span></code></pre><h2 id=full-api-docs>Full API docs</h2><p>The full android api documentation can be accessed from <a href=/android_api>here</a></div></div></main><div class=row-start-3><footer class="footer footer-horizontal footer-center bg-base-200 text-base-content rounded pt-6 gap-0"><nav class="grid grid-flow-col gap-4 mb-6"><a title="RSS Feed" href=/atom.xml target=_blank><svg class="inline-block h-4 w-4 mr-2 h-8 w-8" viewbox="0 0 16 16" aria-label=Rss fill=currentColor role=img xmlns=http://www.w3.org/2000/svg><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2m0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2m.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"/></svg></a></nav></footer></div></div></div><div class="drawer-side z-60"><label aria-label="close sidebar" class=drawer-overlay for=main-drawer></label><ul class="menu menu-lg bg-base-200 min-h-full w-80 p-4"><li><a class="link no-underline" href=/get_started> Get Started </a><li><a class="link no-underline menu-active" href=/docs> Docs </a><li><a class="link no-underline" href=/blog> Blog </a></li><hr class="mt-2 mb-2"></ul></div></div><script integrity=sha384-nxw8Jo87y7fZpQFsqL90WtXZoDKnGhfpxnIOGyZzZqSEq+OCZWMH3NV6akwu50BQ lang=en src=/js/search.js?nxw8Jo></script><script integrity=sha384-Q8viz7rndi8MSNDtItDgVWNSrCumjepopRMlz2nElkWPRXDQAcfiZGJbrCJVXdtw src=/elasticlunr.min.js?Q8viz7></script>